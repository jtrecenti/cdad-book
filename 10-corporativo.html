<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; Aplicações corporativas – Ciência de Dados Aplicada ao Direito II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-openai.html" rel="next">
<link href="./09-modelos-classificacao.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-corporativo.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Aplicações corporativas</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ciência de Dados Aplicada ao Direito II</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-organizacao-dados-taxas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Organização de dados, frequências, proporções e taxas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-medidas-posicao-variabilidade.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Medidas de posição e variabilidade</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-visualizacao-seaborn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualizações com seaborn</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-amostras-populacoes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Amostras e populações</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-probabilidade-cnormal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Probabilidade e curva normal</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-testes-hipoteses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Testes de hipóteses</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-correlacao-regressao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Correlação e regressão</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-modelos-classificacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modelos de classificação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-corporativo.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Aplicações corporativas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-openai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Classificação de documentos usando OpenAI GPT-4o-mini</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-exercicios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exercícios</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resumo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Resumo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./refs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#provisionamento" id="toc-provisionamento" class="nav-link active" data-scroll-target="#provisionamento"><span class="header-section-number">10.1</span> Provisionamento</a>
  <ul class="collapse">
  <li><a href="#definições" id="toc-definições" class="nav-link" data-scroll-target="#definições"><span class="header-section-number">10.1.1</span> Definições</a></li>
  <li><a href="#explicando-as-definições" id="toc-explicando-as-definições" class="nav-link" data-scroll-target="#explicando-as-definições"><span class="header-section-number">10.1.2</span> Explicando as definições</a></li>
  <li><a href="#como-a-ciência-de-dados-pode-ajudar" id="toc-como-a-ciência-de-dados-pode-ajudar" class="nav-link" data-scroll-target="#como-a-ciência-de-dados-pode-ajudar"><span class="header-section-number">10.1.3</span> Como a ciência de dados pode ajudar?</a></li>
  <li><a href="#exemplo-prático" id="toc-exemplo-prático" class="nav-link" data-scroll-target="#exemplo-prático"><span class="header-section-number">10.1.4</span> Exemplo prático</a></li>
  <li><a href="#avançado-modelo-considerando-o-tempo-de-encerramento" id="toc-avançado-modelo-considerando-o-tempo-de-encerramento" class="nav-link" data-scroll-target="#avançado-modelo-considerando-o-tempo-de-encerramento"><span class="header-section-number">10.1.5</span> (Avançado) Modelo considerando o tempo de encerramento</a></li>
  </ul></li>
  <li><a href="#estratégia-de-acordo" id="toc-estratégia-de-acordo" class="nav-link" data-scroll-target="#estratégia-de-acordo"><span class="header-section-number">10.2</span> Estratégia de acordo</a>
  <ul class="collapse">
  <li><a href="#definições-1" id="toc-definições-1" class="nav-link" data-scroll-target="#definições-1"><span class="header-section-number">10.2.1</span> Definições</a></li>
  <li><a href="#modelo-de-simulação" id="toc-modelo-de-simulação" class="nav-link" data-scroll-target="#modelo-de-simulação"><span class="header-section-number">10.2.2</span> Modelo de simulação</a></li>
  <li><a href="#efeito-bumerangue" id="toc-efeito-bumerangue" class="nav-link" data-scroll-target="#efeito-bumerangue"><span class="header-section-number">10.2.3</span> Efeito bumerangue</a></li>
  <li><a href="#parcerias-com-tribunais" id="toc-parcerias-com-tribunais" class="nav-link" data-scroll-target="#parcerias-com-tribunais"><span class="header-section-number">10.2.4</span> Parcerias com tribunais</a></li>
  <li><a href="#conclusão" id="toc-conclusão" class="nav-link" data-scroll-target="#conclusão"><span class="header-section-number">10.2.5</span> Conclusão</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Aplicações corporativas</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Como vimos, ciência de dados aplicada ao direito pode ser aplicada em diversas situações. Aqui, vamos trabalhar com duas aplicações focadas em departamentos jurídicos de empresas. A primeira é o provisionamento e a segunda é a estratégia de acordo.</p>
<section id="provisionamento" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="provisionamento"><span class="header-section-number">10.1</span> Provisionamento</h2>
<p>Você trabalha no departamento jurídico de uma grande empresa que vende eletrônicos. A empresa possui uma base de dados de 1000 processos encerrados e 100 casos ativos. A empresa quer saber quanto deve provisionar em cada um dos casos ativos. Para isso, ela te forneceu a base de dados com os processos encerrados e ativos.</p>
<p>O <strong>provisionamento</strong> é uma prática contábil que visa alocar recursos financeiros para cobrir possíveis perdas futuras. Ela é comum em departamentos jurídicos de empresas, já que os litígios têm, por natureza, prazo e valor incertos.</p>
<p>As provisões, passivos contingentes e ativos contingentes são regulados pelo <a href="https://www.cpc.org.br/CPC/Documentos-Emitidos/Pronunciamentos/Pronunciamento?Id=56">Pronunciamento Contábil número 25 do Comitê de Pronunciamentos Contábeis (CPC 25)</a>. O CPC25 é baseado no <a href="https://www.ifrs.org/issued-standards/list-of-standards/ias-37-provisions-contingent-liabilities-and-contingent-assets/"><em>International Accounting Standard</em> (IAS) número 37</a>, produzido pelo <em>International Accounting Standards Board</em> (IASB).</p>
<section id="definições" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="definições"><span class="header-section-number">10.1.1</span> Definições</h3>
<p>Segundo o CPC25, temos as definições abaixo:</p>
<ul>
<li><strong>Provisão</strong>: passivo de prazo ou valor incerto.</li>
<li><strong>Passivo</strong>: obrigação presente da entidade, derivada de eventos passados, cuja liquidação se espera que resulte em saída de recursos da entidade capazes de gerar benefícios econômicos.</li>
<li><strong>Passivo contingente</strong>: duas possíveis definições:
<ul>
<li>obrigação presente (possível) que resulta de eventos passados e cuja existência será confirmada apenas pela ocorrência ou não de um ou mais eventos futuros incertos que não estão totalmente sob controle da entidade.</li>
<li>uma obrigação presente que resulta de eventos passados, mas que não é reconhecida porque: i) não é provável que uma saída de recursos que incorporam benefícios econômicos seja exigida para liquidar a obrigação; ou ii) o valor da obrigação não pode ser mensurado com confiabilidade.</li>
</ul></li>
</ul>
<p>Em sentido geral, todas as provisões são contingentes porque são incertas quanto ao seu prazo ou valor. Porém, nem todos os passivos contingentes são provisões. Para ser uma provisão, a obrigação deve ser presente e derivada de eventos passados.</p>
<p>Uma provisão deve ser reconhecida quando:</p>
<ul>
<li>a entidade tem uma <strong>obrigação presente</strong> como resultado de um evento passado;</li>
<li>é <strong>provável</strong> que uma saída de recursos que incorporam benefícios econômicos seja exigida para liquidar a obrigação; e</li>
<li>o valor da obrigação <strong>pode ser mensurado</strong> com confiabilidade.</li>
</ul>
</section>
<section id="explicando-as-definições" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2" class="anchored" data-anchor-id="explicando-as-definições"><span class="header-section-number">10.1.2</span> Explicando as definições</h3>
<p>As definições de provisão e passivo contingente são bastante técnicas. Vamos explicar com um exemplo.</p>
<p>Um caso acaba de chegar no departamento jurídico. Trata-se de uma reclamação de um consumidor que comprou uma máquina de lavar da empresa e alega que o aparelho pegou fogo, sem causar danos às pessoas, mas causando danos a um móvel. O valor da reclamação é de R$ 15.000,00.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> IFrame</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>IFrame(<span class="st">'assets/decisao.pdf'</span>, width<span class="op">=</span><span class="dv">600</span>, height<span class="op">=</span><span class="dv">450</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

        <iframe width="600" height="450" src="assets/decisao.pdf" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
<p>No momento que o caso chega, a empresa tem uma obrigação possível (o processo judicial), que resulta de um evento passado (a venda da máquina de lavar). Porém, a empresa ainda não sabe se a reclamação é procedente. Portanto, estamos na situação de <strong>passivo contingente</strong>. Nas bases de dados jurídicas, geralmente esses casos são classificados como <strong>perda possível</strong>.</p>
<p>Suponha que, após a realização de uma perícia e da análise cuidadosa da sua equipe de advocacia, a empresa conclui que o fogo do aparelho não foi causado por defeito de fabricação, mas sim por um erro do consumidor. Nesse caso, ainda temos um <strong>passivo contingente</strong>, mas a empresa pode optar por classificar esse caso como <strong>perda remota</strong>.</p>
<p>Suponha, por outro lado, que a perícia e a análise da equipe de advocacia concluem que o fogo foi causado por defeito de fabricação. Nesse caso, é <strong>provável</strong> que a empresa tenha que pagar uma indenização e o valor da indenização <strong>pode ser mensurado</strong> com confiabilidade. Nesse caso, o caso pode ser classificado como <strong>perda provável</strong> e a empresa pode <strong>provisionar</strong> o valor da indenização.</p>
<p><strong>Provisionar</strong> significa alocar recursos financeiros para cobrir possíveis perdas futuras. Geralmente isso é feito guardando-se uma quantia em dinheiro em uma conta bancária específica para esse fim. O valor provisionado é contabilizado como um passivo no balanço da empresa. Por um lado, a provisão garante que a empresa tenha recursos para cobrir as perdas quando elas se manifestarem na realidade. Por outro lado, a provisão pode limitar a atuação da empresa, já que ela está reservando uma quantia para cobrir possíveis perdas.</p>
<p>Além de alocar os recursos financeiros, a empresa deve relatar a provisão em suas demonstrações financeiras. Ou seja, os relatórios financeiros da empresa devem informar que a empresa provisionou um determinado valor para cobrir possíveis perdas futuras. Isso pode afetar a imagem da empresa perante investidores, credores e outros interessados.</p>
<p>Por isso, é importante que o provisionamento seja feito de forma precisa. Se a empresa provisionar muito, ela pode ter menos recursos disponíveis para investir em outras áreas e pode ter uma imagem de empresa com muitos problemas jurídicos. Se a empresa provisionar pouco, ela pode ter problemas de caixa no futuro.</p>
<p>Vale notar que isso é apenas um resumo de um tópico relativamente longo. Nosso objetivo é ver como a ciência de dados pode ajudar nesse processo. Se você quiser saber mais sobre o CPC25, recomendamos a leitura do pronunciamento completo e a consulta a profissionais de contabilidade.</p>
<p>Vale notar também que estamos falando apenas dos passivos contingentes. Existem também os ativos contingentes, que são direitos presentes que surgem de eventos passados e cuja existência será confirmada pela ocorrência ou não de um ou mais eventos futuros incertos que não estão totalmente sob controle da entidade. Por exemplo, uma empresa pode ter um ativo contingente se ela ganhar um processo judicial contra um concorrente. Nesse caso, a empresa terá um direito presente (o direito de receber uma indenização) que surgiu de um evento passado (a violação de uma patente) e cuja existência será confirmada pela decisão judicial. Porém, a empresa não pode reconhecer esse ativo na contabilidade até que a decisão judicial seja proferida. Como a dinâmica contábil dos ativos contingentes é diferente da dos passivos contingentes, não vamos abordá-los nesta apostila.</p>
<div id="cell-7" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> IFrame</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>IFrame(<span class="st">'assets/resultados_gpa.pdf'</span>, width<span class="op">=</span><span class="dv">600</span>, height<span class="op">=</span><span class="dv">450</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

        <iframe width="600" height="450" src="assets/resultados_gpa.pdf" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="como-a-ciência-de-dados-pode-ajudar" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3" class="anchored" data-anchor-id="como-a-ciência-de-dados-pode-ajudar"><span class="header-section-number">10.1.3</span> Como a ciência de dados pode ajudar?</h3>
<p>Cada empresa possui uma política de provisionamento. Essa política está relacionada com os critérios utilizados para classificar casos como perda possível, perda remota e perda provável. A política de provisionamento é uma decisão estratégica da empresa e pode variar de acordo com o setor, o porte e a cultura da empresa.</p>
<p>Geralmente, os processos judiciais começam como perda possível e, à medida que a empresa obtém mais informações, eles são reclassificados como perda remota ou perda provável. Por exemplo, se ocorre uma sentença de primeira instância desfavorável à empresa, o caso pode ser reclassificado como perda provável. Se a sentença é favorável à empresa, o caso pode ser reclassificado como perda remota. Essa classificação, na maioria dos casos, é feita manualmente por advogados, que analisam os documentos do processo, as decisões judiciais e as informações obtidas em audiências e perícias.</p>
<p>É nessa parte que a ciência de dados pode ajudar. A ciência de dados pode ser utilizada para analisar as bases de dados jurídicas e criar modelos que produzem a probabilidade de perda de cada caso, permitindo sua classificação como perda possível, remota ou provável. Por ser baseada no histórico de processos judiciais, essa análise pode ser mais precisa e rápida do que a análise manual feita pelos advogados, economizando recursos e aumentando a transparência do processo de provisionamento.</p>
<p>Como vimos anteriormente, no entanto, não é só o resultado do processo que importa para fins de provisionamento. A empresa também precisa saber o valor da indenização que ela terá que pagar se o caso for desfavorável. A ciência de dados também pode ser utilizada para predizer o valor da indenização para cada caso.</p>
<p>Por último, também é importante saber predizer o tempo que o caso vai levar para ser encerrado. Isso é importante porque a empresa precisa provisionar recursos financeiros para cobrir as despesas com o caso enquanto ele estiver em andamento. No entanto, a empresa não precisa provisionar imediatamente todos os processos, já que alguns deles podem demorar muitos anos para serem encerrados. Os modelos de predição de tempo de encerramento de processos judiciais podem ajudar a empresa a decidir quais processos devem ser provisionados imediatamente e quais podem esperar.</p>
<p><strong>Obs</strong>: O provisionamento considerando o tempo de encerramento do processo é uma prática comum em departamentos jurídicos de empresas. Porém, não é uma prática contábil. O provisionamento contábil é feito apenas com base na probabilidade de perda e no valor da indenização. O tempo de encerramento do processo é uma variável importante para a gestão do departamento jurídico, mas não é uma teoria consolidada na contabilidade.</p>
</section>
<section id="exemplo-prático" class="level3" data-number="10.1.4">
<h3 data-number="10.1.4" class="anchored" data-anchor-id="exemplo-prático"><span class="header-section-number">10.1.4</span> Exemplo prático</h3>
<p>Agora que vimos os conceitos, vamos ver um exemplo prático. Suponha que a empresa de eletrônicos quer saber quanto deve provisionar em cada um dos 100 casos ativos. Para isso, ela te forneceu a base de dados com os processos encerrados e ativos. A base de dados contém as seguintes variáveis:</p>
<ul>
<li><code>id</code>: identificador do processo</li>
<li><code>encerrado</code>: indica se o processo está encerrado (1) ou ativo (0)</li>
<li><code>perda</code>: indica se o processo resultou em perda (1) ou vitória (0)</li>
<li><code>valor_final</code>: valor da indenização paga no processo</li>
<li><code>tempo</code>: tempo de duração do processo até seu encerramento</li>
<li><code>assunto</code>: assunto do processo, que pode ser “consumidor”, “trabalhista” ou “tributário”, por exemplo</li>
<li><code>valor_causa</code>: valor da causa do processo</li>
<li><code>data_distribuicao</code>: data de início do processo</li>
<li><code>comarca</code>: comarca onde o processo foi distribuído, que pode ser “São Paulo”, “São Bernardo do Campo” ou “Santo André”, por exemplo</li>
<li><code>decisao_desfavoravel</code>: indica se houve uma decisão desfavorável à empresa em primeira instância (1) ou não (0)</li>
</ul>
<p>Vamos simular uma base de dados com 1000 processos encerrados e 100 processos ativos usando o python. A base de dados simulada é a seguinte:</p>
<div id="cell-10" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_date(start, end):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> start <span class="op">+</span> timedelta(days<span class="op">=</span>random.randint(<span class="dv">0</span>, <span class="bu">int</span>((end <span class="op">-</span> start).days)))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>n_encerrados <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>n_ativos <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gerar_valor_final(perda, valor_causa, assunto, comarca, encerrado):</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> encerrado <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.nan</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> perda <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  base <span class="op">=</span> valor_causa <span class="op">*</span> np.random.uniform(<span class="fl">0.8</span>, <span class="fl">1.2</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> assunto <span class="op">==</span> <span class="st">"trabalhista"</span>:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base <span class="op">*</span> np.random.uniform(<span class="fl">0.8</span>, <span class="fl">1.1</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> assunto <span class="op">==</span> <span class="st">"tributário"</span>:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base <span class="op">*</span> np.random.uniform(<span class="fl">1.1</span>, <span class="fl">1.5</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base <span class="op">*</span> np.random.uniform(<span class="fl">0.9</span>, <span class="fl">1.3</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gerar_tempo(assunto, comarca):</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  base_tempo <span class="op">=</span> np.random.randint(<span class="dv">300</span>, <span class="dv">1500</span>)  <span class="co"># Base aleatória de 300 a 1500 dias</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> assunto <span class="op">==</span> <span class="st">"tributário"</span>:</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    base_tempo <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> comarca <span class="op">==</span> <span class="st">"São Paulo"</span>:</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    base_tempo <span class="op">*=</span> <span class="fl">0.7</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> base_tempo</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gerar_prob_perda(valor_causa, assunto, comarca, decisao_desfavoravel, encerrado):</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  base_prob <span class="op">=</span> <span class="fl">0.3</span> <span class="cf">if</span> assunto <span class="op">==</span> <span class="st">"tributário"</span> <span class="cf">else</span> <span class="fl">0.2</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> decisao_desfavoravel <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    base_prob <span class="op">+=</span> <span class="fl">0.6</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> valor_causa <span class="op">&gt;</span> <span class="dv">50000</span>:</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    base_prob <span class="op">+=</span> <span class="fl">0.4</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  prob_final <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">&lt;</span> base_prob <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> encerrado <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    prob_final <span class="op">=</span> np.nan</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> prob_final</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>n_processos <span class="op">=</span> <span class="dv">1100</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>processos_simulados <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">'id'</span>: <span class="bu">range</span>(<span class="dv">1</span>, n_processos <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">'encerrado'</span>: [<span class="dv">1</span>] <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span>,  <span class="co"># 1000 encerrados, 100 ativos</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">'valor_causa'</span>: np.<span class="bu">round</span>(np.random.uniform(<span class="dv">1000</span>, <span class="dv">100000</span>, size<span class="op">=</span>n_processos), <span class="dv">2</span>),</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">'assunto'</span>: np.random.choice([<span class="st">'consumidor'</span>, <span class="st">'trabalhista'</span>, <span class="st">'tributário'</span>], size<span class="op">=</span>n_processos),</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">'comarca'</span>: np.random.choice([<span class="st">'São Paulo'</span>, <span class="st">'São Bernardo do Campo'</span>, <span class="st">'Santo André'</span>], size<span class="op">=</span>n_processos),</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">'decisao_desfavoravel'</span>: np.random.choice([<span class="dv">0</span>, <span class="dv">1</span>], size<span class="op">=</span>n_processos, p<span class="op">=</span>[<span class="fl">0.6</span>, <span class="fl">0.4</span>]),  <span class="co"># 60% não desfavorável</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">'data_distribuicao'</span>: [random_date(datetime(<span class="dv">2010</span>, <span class="dv">1</span>, <span class="dv">1</span>), datetime(<span class="dv">2023</span>, <span class="dv">12</span>, <span class="dv">31</span>)) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_processos)]</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>processos_simulados[<span class="st">'perda'</span>] <span class="op">=</span> processos_simulados.<span class="bu">apply</span>(</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> x: gerar_prob_perda(x[<span class="st">'valor_causa'</span>], x[<span class="st">'assunto'</span>], x[<span class="st">'comarca'</span>], x[<span class="st">'decisao_desfavoravel'</span>], x[<span class="st">'encerrado'</span>]), axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>processos_simulados[<span class="st">'valor_final'</span>] <span class="op">=</span> processos_simulados.<span class="bu">apply</span>(</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> x: gerar_valor_final(x[<span class="st">'perda'</span>], x[<span class="st">'valor_causa'</span>], x[<span class="st">'assunto'</span>], x[<span class="st">'comarca'</span>], x[<span class="st">'encerrado'</span>]), axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>processos_simulados[<span class="st">'tempo'</span>] <span class="op">=</span> processos_simulados.<span class="bu">apply</span>(</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> x: gerar_tempo(x[<span class="st">'assunto'</span>], x[<span class="st">'comarca'</span>]) <span class="cf">if</span> x[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> np.nan, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>processos_simulados[<span class="st">'valor_final'</span>] <span class="op">=</span> processos_simulados.<span class="bu">apply</span>(</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> x: <span class="bu">min</span>(x[<span class="st">'valor_final'</span>], x[<span class="st">'valor_causa'</span>]), axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar a variável de tempo desde a distribuição para os processos ativos</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>processos_simulados[<span class="st">'tempo_desde_distribuicao'</span>] <span class="op">=</span> (datetime.now() <span class="op">-</span> pd.to_datetime(processos_simulados[<span class="st">'data_distribuicao'</span>])).dt.days</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-11" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>processos_simulados</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">encerrado</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">assunto</th>
<th data-quarto-table-cell-role="th">comarca</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">data_distribuicao</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
<th data-quarto-table-cell-role="th">tempo</th>
<th data-quarto-table-cell-role="th">tempo_desde_distribuicao</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>1</td>
<td>38079.47</td>
<td>consumidor</td>
<td>São Paulo</td>
<td>1</td>
<td>2012-07-01</td>
<td>1.0</td>
<td>31547.018995</td>
<td>512.4</td>
<td>4491</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>1</td>
<td>95120.72</td>
<td>trabalhista</td>
<td>Santo André</td>
<td>0</td>
<td>2010-07-24</td>
<td>0.0</td>
<td>0.000000</td>
<td>1476.0</td>
<td>5199</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>1</td>
<td>73467.40</td>
<td>tributário</td>
<td>São Bernardo do Campo</td>
<td>1</td>
<td>2016-03-03</td>
<td>1.0</td>
<td>73467.400000</td>
<td>1400.0</td>
<td>3150</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>1</td>
<td>60267.19</td>
<td>tributário</td>
<td>São Bernardo do Campo</td>
<td>0</td>
<td>2015-06-30</td>
<td>0.0</td>
<td>0.000000</td>
<td>712.0</td>
<td>3397</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5</td>
<td>1</td>
<td>16445.85</td>
<td>consumidor</td>
<td>São Paulo</td>
<td>0</td>
<td>2015-01-03</td>
<td>0.0</td>
<td>0.000000</td>
<td>911.4</td>
<td>3575</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1095</th>
<td>1096</td>
<td>0</td>
<td>18476.28</td>
<td>tributário</td>
<td>São Paulo</td>
<td>1</td>
<td>2015-09-12</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3323</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1096</th>
<td>1097</td>
<td>0</td>
<td>22828.13</td>
<td>consumidor</td>
<td>São Paulo</td>
<td>0</td>
<td>2020-04-22</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1639</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1097</th>
<td>1098</td>
<td>0</td>
<td>19457.39</td>
<td>trabalhista</td>
<td>Santo André</td>
<td>0</td>
<td>2015-09-23</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3312</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1098</th>
<td>1099</td>
<td>0</td>
<td>78178.86</td>
<td>tributário</td>
<td>São Paulo</td>
<td>0</td>
<td>2010-03-18</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5327</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1099</th>
<td>1100</td>
<td>0</td>
<td>35662.40</td>
<td>consumidor</td>
<td>Santo André</td>
<td>1</td>
<td>2020-06-08</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1592</td>
</tr>
</tbody>
</table>

<p>1100 rows × 11 columns</p>
</div>
</div>
</div>
<p>Agora vamos preparar a base de dados para cada modelo, como fizemos anteriormente. A única diferença é que teremos, além do modelo de classificação de resultado, um modelo de regressão para prever o valor da indenização e um modelo de regressão para prever o tempo de encerramento do processo.</p>
<p><strong>Modelo de classificação</strong></p>
<div id="cell-14" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criando dummies para variáveis assunto e comarca</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  processos_simulados,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>[<span class="st">'assunto'</span>, <span class="st">'comarca'</span>],</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  drop_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  dtype<span class="op">=</span><span class="bu">int</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos criar os modelos de resultado e valor somente para os processos encerrados</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>df_encerrados <span class="op">=</span> df[df[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># não precisaremos dessas colunas</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>df_encerrados <span class="op">=</span> df_encerrados.drop(columns<span class="op">=</span>[<span class="st">'encerrado'</span>, <span class="st">'data_distribuicao'</span>, <span class="st">'tempo_desde_distribuicao'</span>, <span class="st">'tempo'</span>])</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>df_ativos <span class="op">=</span> df[df[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>df_encerrados.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
<th data-quarto-table-cell-role="th">assunto_trabalhista</th>
<th data-quarto-table-cell-role="th">assunto_tributário</th>
<th data-quarto-table-cell-role="th">comarca_São Bernardo do Campo</th>
<th data-quarto-table-cell-role="th">comarca_São Paulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>38079.47</td>
<td>1</td>
<td>1.0</td>
<td>31547.018995</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>95120.72</td>
<td>0</td>
<td>0.0</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>73467.40</td>
<td>1</td>
<td>1.0</td>
<td>73467.400000</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>60267.19</td>
<td>0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5</td>
<td>16445.85</td>
<td>0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># para separar os dados em treino e teste</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_validate, GridSearchCV</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># regressão logística</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># árvore de decisão</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># random forest</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, RandomForestRegressor</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># matriz de confusão e métricas</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score, recall_score, accuracy_score, f1_score, roc_curve, roc_auc_score, ConfusionMatrixDisplay</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-16" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encerrados.drop(columns<span class="op">=</span>[<span class="st">'perda'</span>, <span class="st">'valor_final'</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>X_ativos <span class="op">=</span> df_ativos.drop(columns<span class="op">=</span>[<span class="st">'encerrado'</span>, <span class="st">'data_distribuicao'</span>, <span class="st">'tempo_desde_distribuicao'</span>, <span class="st">'perda'</span>, <span class="st">'valor_final'</span>, <span class="st">'tempo'</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>y_perda <span class="op">=</span> df_encerrados[<span class="st">'perda'</span>]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>y_valor <span class="op">=</span> df_encerrados[<span class="st">'valor_final'</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># é possível fazer a separação em treino e teste com todas nossas variáveis dependentes de interesse</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_perda_train, y_perda_test, y_valor_train, y_valor_test <span class="op">=</span> train_test_split(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  X, y_perda, y_valor, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>X_train.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">assunto_trabalhista</th>
<th data-quarto-table-cell-role="th">assunto_tributário</th>
<th data-quarto-table-cell-role="th">comarca_São Bernardo do Campo</th>
<th data-quarto-table-cell-role="th">comarca_São Paulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">541</th>
<td>542</td>
<td>61011.29</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">440</th>
<td>441</td>
<td>9398.93</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">482</th>
<td>483</td>
<td>45999.57</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">422</th>
<td>423</td>
<td>10029.40</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">778</th>
<td>779</td>
<td>72283.62</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>y_perda_train.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>541    1.0
440    1.0
482    1.0
422    1.0
778    1.0
Name: perda, dtype: float64</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>y_valor_train.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>541    52845.697821
440     9398.930000
482    45999.570000
422    10029.400000
778    71648.641835
Name: valor_final, dtype: float64</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>X_ativos.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">assunto_trabalhista</th>
<th data-quarto-table-cell-role="th">assunto_tributário</th>
<th data-quarto-table-cell-role="th">comarca_São Bernardo do Campo</th>
<th data-quarto-table-cell-role="th">comarca_São Paulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1000</th>
<td>1001</td>
<td>19328.16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1001</th>
<td>1002</td>
<td>54648.19</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1002</th>
<td>1003</td>
<td>87421.64</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1003</th>
<td>1004</td>
<td>73490.26</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1004</th>
<td>1005</td>
<td>80849.55</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de florestas aleatórias para perda e valor</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de perda</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rf_perda <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>rf_perda.fit(X_train, y_perda_train)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de valor. Note que usamos RandomForestRegressor no lugar de RandomForestClassifier</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>rf_valor <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>rf_valor.fit(X_train, y_valor_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestRegressor.html">?<span>Documentation for RandomForestRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestRegressor(random_state=42)</pre></div> </div></div></div></div>
</div>
</div>
<p>No mundo real, teríamos de trabalhar com a otimização dos hiperparâmetros do modelo. No entanto, como nosso objetivo é apenas ilustrar o processo, vamos usar os modelos de florestas aleatórias com os hiperparâmetros padrão.</p>
<div id="cell-22" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>X_predito <span class="op">=</span> X_ativos.copy()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>X_predito[<span class="st">'perda'</span>] <span class="op">=</span> rf_perda.predict_proba(X_ativos)[:, <span class="dv">1</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>X_predito[<span class="st">'valor_final'</span>] <span class="op">=</span> rf_valor.predict(X_ativos)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>X_predito</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">assunto_trabalhista</th>
<th data-quarto-table-cell-role="th">assunto_tributário</th>
<th data-quarto-table-cell-role="th">comarca_São Bernardo do Campo</th>
<th data-quarto-table-cell-role="th">comarca_São Paulo</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1000</th>
<td>1001</td>
<td>19328.16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0.17</td>
<td>6608.459252</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1001</th>
<td>1002</td>
<td>54648.19</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.64</td>
<td>38553.643555</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1002</th>
<td>1003</td>
<td>87421.64</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.93</td>
<td>84485.949135</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1003</th>
<td>1004</td>
<td>73490.26</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.22</td>
<td>15237.886716</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1004</th>
<td>1005</td>
<td>80849.55</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0.93</td>
<td>72403.530666</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1095</th>
<td>1096</td>
<td>18476.28</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.91</td>
<td>17256.654609</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1096</th>
<td>1097</td>
<td>22828.13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.28</td>
<td>7061.341277</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1097</th>
<td>1098</td>
<td>19457.39</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.32</td>
<td>8331.907196</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1098</th>
<td>1099</td>
<td>78178.86</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.31</td>
<td>33225.020546</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1099</th>
<td>1100</td>
<td>35662.40</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.82</td>
<td>31761.527306</td>
</tr>
</tbody>
</table>

<p>100 rows × 9 columns</p>
</div>
</div>
</div>
<p>Com isso, temos a probabilidade de perda esperada para cada processo, bem como o valor esperado da indenização para cada um deles. Podemos aplicar a política da empresa com base nesses insumos e tomar decisões. Por exemplo, a empresa pode decidir provisionar somente os casos que tiverem alguma decisão desfavorável e cuja probabilidade de perda é maior que 50%. O valor provisionado é a soma do valor final de todos os casos provisionados.</p>
<div id="cell-24" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Um exemplo de como podemos usar o modelo para tomar decisões</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Lembre-se, isso é apenas um exemplo! Tudo depende da política da empresa</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos considerar que a empresa provisiona somente nos casos com decisão desfavorável==1 e perda&gt;0.5</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>X_provisionar <span class="op">=</span> X_predito[(X_predito[<span class="st">'perda'</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">&amp;</span> (X_predito[<span class="st">'decisao_desfavoravel'</span>] <span class="op">==</span> <span class="dv">1</span>)]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>X_provisionar <span class="op">=</span> X_provisionar.copy()[[<span class="st">'id'</span>, <span class="st">'perda'</span>, <span class="st">'valor_final'</span>]]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>X_provisionar.head(<span class="dv">15</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1002</th>
<td>1003</td>
<td>0.93</td>
<td>84485.949135</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1004</th>
<td>1005</td>
<td>0.93</td>
<td>72403.530666</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1008</th>
<td>1009</td>
<td>0.73</td>
<td>18765.443725</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1011</th>
<td>1012</td>
<td>0.96</td>
<td>86351.066654</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1016</th>
<td>1017</td>
<td>0.60</td>
<td>14336.943351</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1020</th>
<td>1021</td>
<td>0.93</td>
<td>65636.248002</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1027</th>
<td>1028</td>
<td>0.95</td>
<td>82979.440932</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1029</th>
<td>1030</td>
<td>0.95</td>
<td>81366.649377</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1030</th>
<td>1031</td>
<td>0.90</td>
<td>2672.454445</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1034</th>
<td>1035</td>
<td>0.87</td>
<td>8325.816117</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1038</th>
<td>1039</td>
<td>0.87</td>
<td>6308.679590</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1039</th>
<td>1040</td>
<td>0.92</td>
<td>23570.829377</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1041</th>
<td>1042</td>
<td>0.87</td>
<td>78797.329211</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1044</th>
<td>1045</td>
<td>0.93</td>
<td>85439.301809</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1048</th>
<td>1049</td>
<td>0.92</td>
<td>83953.100667</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>valor_provisionado <span class="op">=</span> X_provisionar[<span class="st">'valor_final'</span>].<span class="bu">sum</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(valor_provisionado)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1446024.484373209</code></pre>
</div>
</div>
</section>
<section id="avançado-modelo-considerando-o-tempo-de-encerramento" class="level3" data-number="10.1.5">
<h3 data-number="10.1.5" class="anchored" data-anchor-id="avançado-modelo-considerando-o-tempo-de-encerramento"><span class="header-section-number">10.1.5</span> (Avançado) Modelo considerando o tempo de encerramento</h3>
<p>Agora vamos ver como o tempo pode nos ajudar a fazer as provisões. Vamos criar um modelo de regressão para prever o tempo de encerramento do processo. Vamos usar um modelo que não vimos antes chamado ‘modelo de sobrevivência’. Esse modelo é capaz de lidar com o tempo que já passou do processo e com o fato de que o processo ainda não foi encerrado. O modelo de sobrevivência é muito utilizado em estudos de medicina para prever o tempo de sobrevivência de pacientes com câncer, por exemplo.</p>
<p>Como o tempo que já passou do processo é uma variável importante de ser considerada, a análise considera todos os processos na base, ativos e encerrados. Vamos ver como isso funciona na prática.</p>
<p>Nesse caso, utilizamos o modelo de regressão de Cox, que é um modelo de sobrevivência muito popular. Essa parte está <strong>fora do escopo da nossa disciplina</strong>, mas coloco aqui apenas para ilustrar como a ciência de dados pode ser aplicada a esse problema.</p>
<div id="cell-28" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sksurv.linear_model <span class="im">import</span> CoxPHSurvivalAnalysis</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df_survival <span class="op">=</span> df.copy()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>df_survival[<span class="st">'event'</span>] <span class="op">=</span> df_survival[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>df_survival[<span class="st">'duration'</span>] <span class="op">=</span> df_survival.<span class="bu">apply</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> row: row[<span class="st">'tempo'</span>] <span class="cf">if</span> row[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> row[<span class="st">'tempo_desde_distribuicao'</span>], axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>df_survival_ativos <span class="op">=</span> df_survival[df_survival[<span class="st">'encerrado'</span>] <span class="op">==</span> <span class="dv">0</span>].copy()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>X_survival <span class="op">=</span> df_survival.drop(columns<span class="op">=</span>[<span class="st">'encerrado'</span>, <span class="st">'data_distribuicao'</span>, <span class="st">'event'</span>, <span class="st">'duration'</span>,<span class="st">'valor_final'</span>, <span class="st">'tempo'</span>, <span class="st">'perda'</span>])</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>X_ativos_survival <span class="op">=</span> df_survival_ativos.drop(columns<span class="op">=</span>[<span class="st">'encerrado'</span>, <span class="st">'data_distribuicao'</span>, <span class="st">'duration'</span>, <span class="st">'event'</span>,<span class="st">'valor_final'</span>, <span class="st">'tempo'</span>, <span class="st">'perda'</span>])</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>y_survival <span class="op">=</span> df_survival[[<span class="st">'event'</span>, <span class="st">'duration'</span>]].to_records(index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>X_survival</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor_causa</th>
<th data-quarto-table-cell-role="th">decisao_desfavoravel</th>
<th data-quarto-table-cell-role="th">tempo_desde_distribuicao</th>
<th data-quarto-table-cell-role="th">assunto_trabalhista</th>
<th data-quarto-table-cell-role="th">assunto_tributário</th>
<th data-quarto-table-cell-role="th">comarca_São Bernardo do Campo</th>
<th data-quarto-table-cell-role="th">comarca_São Paulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>38079.47</td>
<td>1</td>
<td>4491</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>95120.72</td>
<td>0</td>
<td>5199</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>73467.40</td>
<td>1</td>
<td>3150</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>60267.19</td>
<td>0</td>
<td>3397</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5</td>
<td>16445.85</td>
<td>0</td>
<td>3575</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1095</th>
<td>1096</td>
<td>18476.28</td>
<td>1</td>
<td>3323</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1096</th>
<td>1097</td>
<td>22828.13</td>
<td>0</td>
<td>1639</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1097</th>
<td>1098</td>
<td>19457.39</td>
<td>0</td>
<td>3312</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1098</th>
<td>1099</td>
<td>78178.86</td>
<td>0</td>
<td>5327</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1099</th>
<td>1100</td>
<td>35662.40</td>
<td>1</td>
<td>1592</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>1100 rows × 8 columns</p>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de sobrevivência</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>coxph <span class="op">=</span> CoxPHSurvivalAnalysis()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>coxph.fit(X_survival, y_survival)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>pred_survival <span class="op">=</span> coxph.predict_survival_function(X_ativos_survival)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Depois de obter as predições, precisamos estimar o tempo de encerramento do processo. Isso precisa levar em conta o tempo que já passou do processo. Para isso, vamos usar a função de sobrevivência do modelo de Cox. Com base nela, aplicamos algumas condições para considerar o tempo desde a distribuição na estimativa do tempo de encerramento.</p>
<div id="cell-31" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para cada caso ativo, calcular o tempo restante condicional ao tempo já decorrido</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>estimated_times <span class="op">=</span> []</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, func <span class="kw">in</span> <span class="bu">enumerate</span>(pred_survival):</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  tempo_decorrido <span class="op">=</span> df_survival_ativos.iloc[i][<span class="st">'tempo_desde_distribuicao'</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Encontrar o ponto da curva de sobrevivência onde estamos atualmente (tempo &gt;= tempo_decorrido)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  mask <span class="op">=</span> func.x <span class="op">&gt;=</span> tempo_decorrido</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> np.<span class="bu">any</span>(mask):  <span class="co"># Verifica se há dados para esse intervalo de tempo</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    cond_survival_prob <span class="op">=</span> func.y[mask]  <span class="co"># Sobrevivência condicional a partir de tempo_decorrido</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    cond_time_points <span class="op">=</span> func.x[mask]  <span class="co"># Tempos correspondentes</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica se existe uma mediana de sobrevivência &lt;= 0.5</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    time_median_idx <span class="op">=</span> np.where(cond_survival_prob <span class="op">&lt;=</span> <span class="fl">0.5</span>)[<span class="dv">0</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(time_median_idx) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># O tempo restante será o ponto mediano a partir de agora</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>      time_remaining <span class="op">=</span> cond_time_points[time_median_idx[<span class="dv">0</span>]] <span class="op">-</span> tempo_decorrido</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Caso não tenha um ponto onde a sobrevivência seja &lt;= 0.5, consideramos o último tempo disponível</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>      time_remaining <span class="op">=</span> cond_time_points[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> tempo_decorrido</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      time_remaining <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Caso o tempo decorrido seja maior que o maior tempo predito pela curva de sobrevivência</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  estimated_times.append(time_remaining)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>X_ativos_survival[<span class="st">'tempo_restante'</span>] <span class="op">=</span> estimated_times</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>X_ativos_survival[[<span class="st">'id'</span>, <span class="st">'tempo_desde_distribuicao'</span>, <span class="st">'tempo_restante'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">tempo_desde_distribuicao</th>
<th data-quarto-table-cell-role="th">tempo_restante</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1000</th>
<td>1001</td>
<td>3086</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1001</th>
<td>1002</td>
<td>2958</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1002</th>
<td>1003</td>
<td>595</td>
<td>651.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1003</th>
<td>1004</td>
<td>653</td>
<td>585.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1004</th>
<td>1005</td>
<td>1392</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1095</th>
<td>1096</td>
<td>3323</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1096</th>
<td>1097</td>
<td>1639</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1097</th>
<td>1098</td>
<td>3312</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1098</th>
<td>1099</td>
<td>5327</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1099</th>
<td>1100</td>
<td>1592</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>100 rows × 3 columns</p>
</div>
</div>
</div>
<p>Note que, em alguns casos, o tempo estimado foi zero. Isso aconteceu porque o tempo desde a distribuição é maior do que o tempo estimado de encerramento. Nesses casos, consideramos o tempo desde a distribuição como o tempo estimado de encerramento.</p>
<p>Agora, podemos juntar as informações de probabilidade de perda, valor da indenização e tempo de encerramento do processo para tomar decisões de provisionamento.</p>
<div id="cell-33" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>X_provisionar_tempo <span class="op">=</span> X_provisionar.merge(X_ativos_survival[[<span class="st">'id'</span>, <span class="st">'tempo_restante'</span>]], on<span class="op">=</span><span class="st">'id'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>X_provisionar_tempo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
<th data-quarto-table-cell-role="th">tempo_restante</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1003</td>
<td>0.93</td>
<td>84485.949135</td>
<td>651.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1005</td>
<td>0.93</td>
<td>72403.530666</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1009</td>
<td>0.73</td>
<td>18765.443725</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1012</td>
<td>0.96</td>
<td>86351.066654</td>
<td>385.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1017</td>
<td>0.60</td>
<td>14336.943351</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>1021</td>
<td>0.93</td>
<td>65636.248002</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>1028</td>
<td>0.95</td>
<td>82979.440932</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1030</td>
<td>0.95</td>
<td>81366.649377</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>1031</td>
<td>0.90</td>
<td>2672.454445</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1035</td>
<td>0.87</td>
<td>8325.816117</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>1039</td>
<td>0.87</td>
<td>6308.679590</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>1040</td>
<td>0.92</td>
<td>23570.829377</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>1042</td>
<td>0.87</td>
<td>78797.329211</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1045</td>
<td>0.93</td>
<td>85439.301809</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>1049</td>
<td>0.92</td>
<td>83953.100667</td>
<td>489.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1050</td>
<td>0.84</td>
<td>2718.351957</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1051</td>
<td>0.91</td>
<td>86124.536815</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>1052</td>
<td>0.96</td>
<td>53316.948681</td>
<td>1552.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1058</td>
<td>0.64</td>
<td>36376.152361</td>
<td>552.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>1063</td>
<td>0.89</td>
<td>77536.403123</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>1066</td>
<td>0.93</td>
<td>72570.340488</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1071</td>
<td>0.82</td>
<td>24704.700949</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>1072</td>
<td>0.94</td>
<td>14100.567213</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>1074</td>
<td>0.77</td>
<td>2690.415733</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>1080</td>
<td>0.89</td>
<td>87280.525331</td>
<td>183.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>1081</td>
<td>0.95</td>
<td>78355.151460</td>
<td>642.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1088</td>
<td>0.97</td>
<td>15154.164214</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>1094</td>
<td>0.91</td>
<td>50685.261076</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>1096</td>
<td>0.91</td>
<td>17256.654609</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>1100</td>
<td>0.82</td>
<td>31761.527306</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Agora, podemos considerar um valor acumulado da provisão ao longo do tempo, considerando o tempo restante. Isso nos dá uma ideia de quanto a empresa deve provisionar no tempo para cobrir as perdas futuras.</p>
<div id="cell-35" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>X_provisionar_tempo <span class="op">=</span> X_provisionar_tempo.sort_values(<span class="st">'tempo_restante'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pegando o valor acumulado e dividindo por 1000 para facilitar a visualização</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>X_provisionar_tempo[<span class="st">'valor_acu'</span>] <span class="op">=</span> X_provisionar_tempo[<span class="st">'valor_final'</span>].cumsum() <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>X_provisionar_tempo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">perda</th>
<th data-quarto-table-cell-role="th">valor_final</th>
<th data-quarto-table-cell-role="th">tempo_restante</th>
<th data-quarto-table-cell-role="th">valor_acu</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>1005</td>
<td>0.93</td>
<td>72403.530666</td>
<td>0.0</td>
<td>72.403531</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2</th>
<td>1009</td>
<td>0.73</td>
<td>18765.443725</td>
<td>0.0</td>
<td>91.168974</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5</th>
<td>1021</td>
<td>0.93</td>
<td>65636.248002</td>
<td>0.0</td>
<td>156.805222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">4</th>
<td>1017</td>
<td>0.60</td>
<td>14336.943351</td>
<td>0.0</td>
<td>171.142166</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>1028</td>
<td>0.95</td>
<td>82979.440932</td>
<td>0.0</td>
<td>254.121607</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1030</td>
<td>0.95</td>
<td>81366.649377</td>
<td>0.0</td>
<td>335.488256</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">9</th>
<td>1035</td>
<td>0.87</td>
<td>8325.816117</td>
<td>0.0</td>
<td>343.814072</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">8</th>
<td>1031</td>
<td>0.90</td>
<td>2672.454445</td>
<td>0.0</td>
<td>346.486527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>1042</td>
<td>0.87</td>
<td>78797.329211</td>
<td>0.0</td>
<td>425.283856</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1045</td>
<td>0.93</td>
<td>85439.301809</td>
<td>0.0</td>
<td>510.723158</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>1039</td>
<td>0.87</td>
<td>6308.679590</td>
<td>0.0</td>
<td>517.031837</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>1040</td>
<td>0.92</td>
<td>23570.829377</td>
<td>0.0</td>
<td>540.602667</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">15</th>
<td>1050</td>
<td>0.84</td>
<td>2718.351957</td>
<td>0.0</td>
<td>543.321019</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1071</td>
<td>0.82</td>
<td>24704.700949</td>
<td>0.0</td>
<td>568.025720</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">19</th>
<td>1063</td>
<td>0.89</td>
<td>77536.403123</td>
<td>0.0</td>
<td>645.562123</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">16</th>
<td>1051</td>
<td>0.91</td>
<td>86124.536815</td>
<td>0.0</td>
<td>731.686659</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">29</th>
<td>1100</td>
<td>0.82</td>
<td>31761.527306</td>
<td>0.0</td>
<td>763.448187</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">28</th>
<td>1096</td>
<td>0.91</td>
<td>17256.654609</td>
<td>0.0</td>
<td>780.704841</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1088</td>
<td>0.97</td>
<td>15154.164214</td>
<td>0.0</td>
<td>795.859006</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">20</th>
<td>1066</td>
<td>0.93</td>
<td>72570.340488</td>
<td>0.0</td>
<td>868.429346</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>1072</td>
<td>0.94</td>
<td>14100.567213</td>
<td>0.0</td>
<td>882.529913</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>1074</td>
<td>0.77</td>
<td>2690.415733</td>
<td>0.0</td>
<td>885.220329</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">27</th>
<td>1094</td>
<td>0.91</td>
<td>50685.261076</td>
<td>0.0</td>
<td>935.905590</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">24</th>
<td>1080</td>
<td>0.89</td>
<td>87280.525331</td>
<td>183.0</td>
<td>1023.186115</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">3</th>
<td>1012</td>
<td>0.96</td>
<td>86351.066654</td>
<td>385.0</td>
<td>1109.537182</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14</th>
<td>1049</td>
<td>0.92</td>
<td>83953.100667</td>
<td>489.0</td>
<td>1193.490283</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1058</td>
<td>0.64</td>
<td>36376.152361</td>
<td>552.0</td>
<td>1229.866435</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>1081</td>
<td>0.95</td>
<td>78355.151460</td>
<td>642.0</td>
<td>1308.221587</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1003</td>
<td>0.93</td>
<td>84485.949135</td>
<td>651.0</td>
<td>1392.707536</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>1052</td>
<td>0.96</td>
<td>53316.948681</td>
<td>1552.0</td>
<td>1446.024484</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Colocando isso em um gráfico, temos:</p>
<div id="cell-37" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  data<span class="op">=</span>X_provisionar_tempo,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  x<span class="op">=</span><span class="st">'tempo_restante'</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  y<span class="op">=</span><span class="st">'valor_acu'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  drawstyle<span class="op">=</span><span class="st">'steps-post'</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  errorbar<span class="op">=</span>(<span class="st">'ci'</span>, <span class="va">False</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  plt.axvline(i <span class="op">*</span> <span class="fl">365.25</span>, color<span class="op">=</span><span class="st">'lightgray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Tempo restante (dias)'</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Valor acumulado ($ mil)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Text(0, 0.5, 'Valor acumulado ($ mil)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Considerando esse gráfico, a empresa pode considerar provisionar um valor acumulado de cerca de 1 milhão para cobrir as perdas do próximo exercício, e incluir uma provisão adicional para cobrir os processos com tempo de encerramento mais longo, classificando esses casos como perda possível para fins contábeis, indicando que não é possível fazer estimativa confiável nos casos muito longos.</p>
<p>Vale enfatizar, novamente, que esse tipo de estratégia não é algo praticado por todas as empresas. Cada empresa tem sua própria política de provisionamento e deve seguir as normas contábeis vigentes.</p>
<hr>
</section>
</section>
<section id="estratégia-de-acordo" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="estratégia-de-acordo"><span class="header-section-number">10.2</span> Estratégia de acordo</h2>
<p>É comum tentar realizar acordos nos casos em que a empresa acredita que a probabilidade de perda é alta. Isso pode ser feito para evitar custos com o processo, para evitar a exposição da empresa ou para evitar a perda de tempo e recursos com um processo que a empresa acredita que vai perder. Sem considerar, é claro, os ganhos sociais, já que a parte contrária também pode ter interesse em um acordo e o acordo economiza tempo e recursos do judiciário.</p>
<p>No entanto, realizar acordos nem sempre é tão simples. Quando fazemos acordo, estamos antecipando um custo, que só seria realizado no futuro se o processo fosse desfavorável. Claro que o sistema corrige essa antecipação através de taxas de atualização (o valor de indenização geralmente sofre atualizações monetárias até o pagamento efetivo), mas ainda assim é um custo que a empresa está antecipando. Pode ser simplesmente que a empresa não tenha caixa suficiente para fazer acordos em todos os casos que ela gostaria de fazer.</p>
<p>Outro aspecto importante a considerar ao fazer acordos é a probabilidade de sucesso do acordo. Em certos casos, pode ser que a parte contrária considere o valor do acordo muito baixo e decida levar o caso até o fim. Nesses casos, a empresa terá gastos extras com a tentativa de acordo e ainda terá que arcar com os custos do processo.</p>
<p>A ciência de dados pode ser utilizada para ajudar a empresa a decidir quais casos devem ser alvo de acordo e qual o valor do acordo. A ideia é criar um modelo que consiga predizer a probabilidade de sucesso do acordo para cada valor ofertado. Com base nessas previsões e no orçamento da empresa, é possível decidir quais casos devem ser alvo de acordo e qual o valor ofertado em cada caso.</p>
<section id="definições-1" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="definições-1"><span class="header-section-number">10.2.1</span> Definições</h3>
<p>Uma variável importante a ser considerada em uma estratégia de acordo é a <strong>alçada</strong>. A <strong>alçada</strong> geralmente é a proporção do valor pedido que a empresa está disposta a pagar para fazer um acordo. Por exemplo, se a empresa está disposta a pagar até 50% do valor pedido para fazer um acordo, a alçada é de 50%. Se a empresa está disposta a pagar até 80% do valor pedido para fazer um acordo, a alçada é de 80%. O valor de alçada é a multiplicação do valor pedido pelo valor de alçada. Por exemplo, se o valor pedido é de R$ 100.000,00 e a alçada é de 50%, o valor de alçada é de R$ 50.000,00.</p>
<p>Quanto maior a alçada, mais agressiva é a estratégia de acordo. Por um lado, uma alçada alta aumenta a probabilidade de sucesso do acordo, já que a empresa está disposta a pagar um valor maior. Por outro lado, uma alçada alta aumenta o custo do acordo, já que a empresa está pagando um valor maior para fazer o acordo.</p>
<p>Idealmente, cada processo teria uma alçada diferente, otimizada para maximizar a economia da empresa. No entanto, isso pode ser inviável na prática, já que as empresas geralmente não têm informações sobre tentativas frustradas de acordo, que seriam ideais para calibrar a alçada. Por isso, é comum que as empresas adotem uma alçada fixa para todos os processos, ou mude somente de acordo com algumas variáveis predefinidas, como tipo de processo (consumidor, trabalhista, tributário, etc.) e separação entre casos de massa e casos estratégicos.</p>
<p>Outra variável que vamos considerar é o <strong>orçamento</strong>. O orçamento é o valor total que a empresa está disposta a gastar com acordos em um determinado período. Isso geralmente é uma decisão estratégica da empresa e pode variar de acordo com a situação atual da empresa. Uma prática comum no mercado é considerar sobras de provisão de exercícios anteriores como orçamento para acordos no exercício seguinte. Por exemplo, se a empresa provisionou R$ 1.000.000,00 para cobrir perdas futuras e gastou somente R$ 800.000,00 em acordos no exercício anterior, ela pode considerar os R$ 200.000,00 restantes como orçamento para acordos no exercício seguinte.</p>
<p>Finalmente, também é importante considerar um número <strong>máximo de tentativas</strong> por mês. Isso é importante porque, em uma empresa com muitos processos, pode ser que a empresa não tenha recursos humanos suficientes para fazer acordos em todos os processos. Nesse caso, é importante priorizar os processos mais importantes e deixar os menos importantes para o mês seguinte.</p>
</section>
<section id="modelo-de-simulação" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="modelo-de-simulação"><span class="header-section-number">10.2.2</span> Modelo de simulação</h3>
<p>Uma forma de estudar estratégias de acordo é simulando cenários. Por exemplo, podemos estudar os gastos ao longo do tempo em três cenários: 1) sem estratégia de acordo, 2) com estratégia de acordo branda e 3) com estratégia de acordo agressiva. O esperado é que a estratégia de acordo agressiva resulte em menos gastos com processos judiciais, já que a empresa está fazendo mais acordos. Por outro lado, a estratégia de acordo agressiva pode resultar em uma antecipação de gastos maiores com acordos, já que a empresa traria mais processos a valor presente.</p>
<p>Para fazer a simulação precisamos, além da alçada e do orçamento, uma base de dados com os processos ativos, acompanhada de estimativas de probabilidade de sucesso do acordo em função da alçada, da probabilidade de derrota do processo (para fins de ordenação), e do tempo esperado para encerramento do processo.</p>
<p>A função da probabilidade acordo de acordo com a alçada pode ser estimada com base nos dados de acordos passados da empresa através de um modelo de regressão logística, ou então pode ser definida manualmente pela empresa, caso não existam dados suficientes. Já o tempo esperado para encerramento do processo pode ser estimado com um modelo de regressão de sobrevivência, como vimos anteriormente.</p>
<p>Vamos simular uma base de dados com 100 processos ativos e criar um modelo de regressão para prever a probabilidade de sucesso do acordo em função da alçada e do tempo esperado para encerramento do processo. Para isso, vamos considerar a seguinte função de probabilidade de acordo:</p>
<p><span class="math display">\[
\log \left( \frac{P(\text{acordo})}{1 - P(\text{acordo})} \right) = -10 + 15 \cdot \text{alçada}
\]</span></p>
<p>ou, equivalentemente,</p>
<p><span class="math display">\[
P(\text{acordo}) = \frac{1}{1 + e^{10 - 15 \cdot \text{alçada} }}
\]</span></p>
<p>Os valores de 10 (intercepto) e 20 (coeficiente angular) foram escolhidos de forma arbitrária. Na prática, esse valor seria estimado com base nos dados de acordos passados da empresa.</p>
<div id="cell-41" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> p_acordo(alcada, alpha <span class="op">=</span> <span class="dv">15</span>):</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>np.exp(<span class="dv">10</span> <span class="op">-</span> alcada <span class="op">*</span> alpha)))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>alcadas <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>prob_acordo <span class="op">=</span> p_acordo(alcadas)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.plot(alcadas, prob_acordo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Vamos considerar esses três cenários:</p>
<ol type="1">
<li><strong>Sem estratégia de acordo</strong>: a empresa não faz acordo em nenhum processo.</li>
<li><strong>Estratégia de acordo branda</strong>: a empresa faz acordo usando a alçada de 50% em todos os processos.</li>
<li><strong>Estratégia de acordo agressiva</strong>: a empresa faz acordo usando a alçada de 80% em todos os processos.</li>
</ol>
<div id="cell-43" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p_acordo(<span class="fl">0.5</span>), p_acordo(<span class="fl">0.8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.07585818002124355 0.8807970779778823</code></pre>
</div>
</div>
<p>Isso nos leva ao seguinte código:</p>
<div id="cell-45" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Configurações para a simulação</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>n_processos <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>valores_causa <span class="op">=</span> np.random.uniform(<span class="dv">5000</span>, <span class="dv">100000</span>, n_processos)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>prob_derrota <span class="op">=</span> np.random.uniform(<span class="fl">0.1</span>, <span class="fl">0.9</span>, n_processos)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>tempos_esperados <span class="op">=</span> np.random.uniform(<span class="dv">1</span>, <span class="dv">5</span>, n_processos)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> p_acordo(alcada, alpha <span class="op">=</span> <span class="dv">15</span>):</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>np.exp(<span class="dv">10</span> <span class="op">-</span> alcada <span class="op">*</span> alpha)))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcular_valor_alcada(valor_causa, alcada):</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> valor_causa <span class="op">*</span> alcada</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>alcada_branda <span class="op">=</span> <span class="fl">0.50</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>alcada_agressiva <span class="op">=</span> <span class="fl">0.80</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>valores_alcada_branda <span class="op">=</span> calcular_valor_alcada(valores_causa, alcada_branda)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>valores_alcada_agressiva <span class="op">=</span> calcular_valor_alcada(valores_causa, alcada_agressiva)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Criação do dataframe</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'id'</span>: np.arange(<span class="dv">1</span>, n_processos <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'valor'</span>: valores_causa,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'valor_alcada_branda'</span>: valores_alcada_branda,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'valor_alcada_agressiva'</span>: valores_alcada_agressiva,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'prob_derrota'</span>: prob_derrota,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tempo'</span>: tempos_esperados</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">valor</th>
<th data-quarto-table-cell-role="th">valor_alcada_branda</th>
<th data-quarto-table-cell-role="th">valor_alcada_agressiva</th>
<th data-quarto-table-cell-role="th">prob_derrota</th>
<th data-quarto-table-cell-role="th">tempo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>40581.311290</td>
<td>20290.655645</td>
<td>32465.049032</td>
<td>0.125143</td>
<td>3.568127</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>95317.859109</td>
<td>47658.929554</td>
<td>76254.287287</td>
<td>0.609128</td>
<td>1.336560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>74539.424472</td>
<td>37269.712236</td>
<td>59631.539578</td>
<td>0.351485</td>
<td>1.646515</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>61872.555999</td>
<td>30936.277999</td>
<td>49498.044799</td>
<td>0.506857</td>
<td>4.594217</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5</td>
<td>19821.770842</td>
<td>9910.885421</td>
<td>15857.416674</td>
<td>0.826053</td>
<td>3.425716</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">95</th>
<td>96</td>
<td>51910.581655</td>
<td>25955.290827</td>
<td>41528.465324</td>
<td>0.379368</td>
<td>3.088973</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">96</th>
<td>97</td>
<td>54659.618791</td>
<td>27329.809396</td>
<td>43727.695033</td>
<td>0.680765</td>
<td>4.079974</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">97</th>
<td>98</td>
<td>45616.396744</td>
<td>22808.198372</td>
<td>36493.117395</td>
<td>0.817688</td>
<td>1.863284</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">98</th>
<td>99</td>
<td>7414.817041</td>
<td>3707.408520</td>
<td>5931.853633</td>
<td>0.809669</td>
<td>3.491562</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">99</th>
<td>100</td>
<td>15249.685564</td>
<td>7624.842782</td>
<td>12199.748451</td>
<td>0.723900</td>
<td>1.341390</td>
</tr>
</tbody>
</table>

<p>100 rows × 6 columns</p>
</div>
</div>
</div>
<p>Digamos que a empresa adote a seguinte estratégia: vamos tentar fazer acordo em todos os processos com probabilidade de derrota maior do que 50%, utilizando uma alçada, até que nosso orçamento seja atingido. O orçamento considerado é de 2 milhões e o limite de tentativas de acordo por mês é 30, por questões de alocação de funcionários. Se a proposta de acordo for rejeitada, passamos para o próximo processo. Se a proposta de acordo for aceita, o processo é encerrado e o valor do acordo é provisionado.</p>
<p>Vamos simular essas estratégias e ver como elas se comportam ao longo do tempo. Para cada estratégia, vamos fazer 100 simulações, para considerar a aleatoriedade dos processos judiciais. Vamos construir um aplicativo utilizando o <code>streamlit</code> para visualizar os resultados, com o auxílio do ChatGPT.</p>
<p>O menu do streamlit possui as seguintes configurações:</p>
<ul>
<li><strong>Número de tentativas por mês</strong>: número de tentativas de acordo por mês.</li>
<li><strong>Orçamento</strong>: orçamento disponível para acordos.</li>
<li><strong>Alçada</strong>: valor da alçada para a estratégia de acordo branda.</li>
<li><strong>Probabilidade mínima de derrota</strong>: probabilidade mínima de derrota para fazer acordo.</li>
<li><strong>Número de simulações</strong>: número de simulações a serem realizadas.</li>
</ul>
<p>Link do app: <a href="https://app-acordo.streamlit.app/" class="uri">https://app-acordo.streamlit.app/</a> Código do app: <a href="https://github.com/jtrecenti/main-cdad2/blob/main/apostilas/10-corporativo/app_acordo.py" class="uri">https://github.com/jtrecenti/main-cdad2/blob/main/apostilas/10-corporativo/app_acordo.py</a></p>
<p>A análise produz dois gráficos: o primeiro mostra os gastos acumulados ao longo do tempo para a estratégia com acordo, comparada com a estratégia sem acordo. O segundo gráfico mostra a diferença entre os gastos acumulados ao longo do tempo para a estratégia com acordo e a estratégia sem acordo.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-6-image.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-1-image-2.png" class="img-fluid figure-img"></p>
<figcaption>image-2.png</figcaption>
</figure>
</div>
<p>Veja que, nos primeiros 40 meses, a estratégia de acordo é mais custosa que a estratégia sem acordo. Isso acontece porque a empresa está antecipando custos com acordos que só seriam realizados no futuro. No entanto, a partir do mês 40, a estratégia de acordo começa a ser mais barata que a estratégia sem acordo.</p>
<p>A empresa fica até 600 mil no negativo entre o mês 10 e mês 20, no que seria o <em>break-even</em> desse investimento. A partir do mês 40, a empresa começa a economizar dinheiro com a estratégia de acordo. No final do período, a empresa economiza cerca de 600 mil com a estratégia de acordo.</p>
<p>Agora, mudamos o cenário para uma alçada de 80%. Com essa configuração, o gasto inicial é maior, e o gasto com acordos também. No final do período, a empresa acaba não economizando.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-2-image-3.png" class="img-fluid figure-img"></p>
<figcaption>image-3.png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-3-image-4.png" class="img-fluid figure-img"></p>
<figcaption>image-4.png</figcaption>
</figure>
</div>
<p>Finalmente, fazemos uma simulação com maior orçamento. Consideramos orçamento de 6 milhões e 50 tentativas por mês, com a alçada de 50%. Nesse caso, a empresa economiza cerca de 1 milhão no final do período, mas com um valor negativo máximo de mais de 1 milhão ao comparar as estratégias.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-4-image-5.png" class="img-fluid figure-img"></p>
<figcaption>image-5.png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10-corporativo_files/figure-html/cell-46-5-image-6.png" class="img-fluid figure-img"></p>
<figcaption>image-6.png</figcaption>
</figure>
</div>
</section>
<section id="efeito-bumerangue" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="efeito-bumerangue"><span class="header-section-number">10.2.3</span> Efeito bumerangue</h3>
<p>A estratégia de acordo, na prática, apresenta ainda mais desafios. Um deles é a litigiosidade. Se a empresa adota uma estratégia de acordo que fica conhecida entre pessoas e advogados, pode ser que ela seja alvo de mais processos judiciais. Isso acontece porque as pessoas podem achar que a empresa é mais propensa a fazer acordo e, portanto, podem entrar com processos judiciais com valores mais altos. Para lidar com isso, a empresa pode adotar mecanismos de aleatorização: por exemplo, fazer acordo em apenas 50% dos processos elencados, escolhendo esses casos de forma aleatória. Isso pode reduzir a litigiosidade e aumentar a eficiência da estratégia de acordo.</p>
</section>
<section id="parcerias-com-tribunais" class="level3" data-number="10.2.4">
<h3 data-number="10.2.4" class="anchored" data-anchor-id="parcerias-com-tribunais"><span class="header-section-number">10.2.4</span> Parcerias com tribunais</h3>
<p>Uma oportunidade para fazer mais acordos é realizar parcerias com os tribunais. Como os tribunais são interessados em acordos, periodicamente são realizados mutirões de conciliação, onde as partes são chamadas para tentar fazer acordo. A empresa pode se inscrever nesses mutirões e tentar fazer acordo com os autores dos processos. Nesse cenário é possível que as partes estejam mais propensas a fazer acordos, o que reduz o custo de aplicar a estratégia e evita o efeito bumerangue, já que a entidade acionadora do acordo é o tribunal, e não a empresa.</p>
</section>
<section id="conclusão" class="level3" data-number="10.2.5">
<h3 data-number="10.2.5" class="anchored" data-anchor-id="conclusão"><span class="header-section-number">10.2.5</span> Conclusão</h3>
<p>A estratégia de acordo é uma ferramenta poderosa para empresas que querem economizar dinheiro com processos judiciais e reduzir seu acervo de processos. No entanto, é importante considerar a alçada, o orçamento e disposição da empresa em investir nesses acordos. A ciência de dados pode ser utilizada para ajudar a empresa a decidir quais casos devem ser alvo de acordo e quais os valores praticados. No entanto, é importante lembrar que a ciência de dados é um guia e não a solução completa. A decisão final deve ser tomada uma equipe multidisciplinar, considerando todos os aspectos do problema.</p>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09-modelos-classificacao.html" class="pagination-link" aria-label="Modelos de classificação">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modelos de classificação</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-openai.html" class="pagination-link" aria-label="Classificação de documentos usando OpenAI GPT-4o-mini">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Classificação de documentos usando OpenAI GPT-4o-mini</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>